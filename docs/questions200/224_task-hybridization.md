# 224 任务混部

## 题目描述

公司创新实验室正在研究如何最小化资源成本，最大化资源利用率，请你设计算法帮他们解决一个任务混部问题：有`taskNum`项任务，每个任务有开始时间`startTime`、结束时间`endTime`、并行度`parallelism`三个属性，其中并行度是指这个任务运行时将会占用的服务器数量，一个服务器在每个时刻可以被任意任务使用，但最多被一个任务占用，任务运行完会立即释放（结束时刻不占用）。任务混部问题是指给定一批任务，让这批任务由同一批服务器承载运行，请你计算完成这批任务混部最少需要多少服务器，从而最大化控制资源成本。

## 输入描述

第一行输入为`taskNum`，表示有`taskNum`项任务。

接下来`taskNum`行，每行三个整数，表示每个任务的开始时间`startTime`、结束时间`endTime`、并行度`parallelism`。

取值范围：
- 1 <= taskNum <= 100000
- 0 <= startTime < endTime <= 50000

## 输出描述

一个整数，表示最少需要的服务器数量。

## 示例描述

### 示例一

**输入**

```text
3
2 3 1
6 9 2
0 5 1
```

**输出**

```text
2
```

**说明**

一共有三个任务：
- 第一个任务在时间区间`[2，3)`运行，占用1个服务器
- 第二个任务在时间区间`[6,9)`运行，占用2个服务器
- 第二个任务在时间区间`[0,5)`运行，占用1个服务器
  
需要最多服务器的时间区间为`[2，3)`和`[6,9)`，需要2个服务器。

### 示例二

**输入**

```text
2
3 9 2
4 7 3
```

**输出**

```text
5
```

**说明**
一共有两个任务：
- 第一个任务在时间区间`[3，9)`运行，占用2个服务器
- 第二个任务在时间区间`[4,7)`运行，占用3个服务器
  
需要最多服务器的时间区间为`[4，7)`，需要5个服务器。

## 解题思路

1. 初始化时刻所占服务器数量的字典`time_servers`，`key`为时刻，`value`为服务器数量。
2. 遍历任务列表：遍历时间区间，给对应的时刻累加服务器个数。
3. 返回字典中服务器数量最大值。

## 解题代码

```python
from collections import defaultdict


def solve_method(tasks):
    # 时刻所占服务器数量的字典，key为时刻，value为服务器数量
    time_servers = defaultdict(int)

    for task in tasks:
        parallelism = task[2]
        for i in range(task[0], task[1]):
            time_servers[i] += parallelism

    # 取出服务器数量最大的那个
    return max(time_servers.values())


if __name__ == '__main__':
    tasks = [[2, 3, 1],
             [6, 9, 2],
             [0, 5, 1]]

    assert solve_method(tasks) == 2

    tasks = [[3, 9, 2],
             [4, 7, 3]]

    assert solve_method(tasks) == 5
```